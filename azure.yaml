# azure.yaml - Azure Developer CLI configuration for wasslago-api-translation
name: wasslago-api-translation
metadata:
  template: wasslago-api-translation@0.0.1-beta

infra:
  provider: bicep
  path: infra

services:
  api:
    project: .
    language: python
    host: containerapp
    docker:
      path: ./Dockerfile.azure-fixed
    env:
      TEMP_FOLDER: "/app/temp"
      DOC_FOLDER: "/app/doc"
      SAVE_DIR: "/app/translated"
      POPPLER_PATH: "/usr/bin"
      YOLO_MODEL_PATH: "/app/models/yolov11x_best.pt"
      YOLO_MODEL_FILENAME: "yolov11x_best.pt"
      AZURE_STORAGE_CONTAINER_NAME: "models"
      YOLO_MODEL_BLOB_NAME: "yolov11x_best.pt"

hooks:
  postprovision:
    - az keyvault secret set --vault-name ${AZURE_KEY_VAULT_NAME} --name "GEMINI-API-KEY" --value "${GEMINI_API_KEY}" --only-show-errors
    - az containerapp update --name ${AZURE_CONTAINER_APP_NAME} --resource-group ${AZURE_RESOURCE_GROUP} --set-env-vars GEMINI_API_KEY=secretref:gemini-api-key --only-show-errors
